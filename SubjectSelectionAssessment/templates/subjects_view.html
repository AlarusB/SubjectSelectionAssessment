{% extends '_layout.html' %}

{% block title %}View profile{% endblock %}

{% block content %}
<header class="flex column">



    <div class="profile-top flex row">

        <div class="profile-title">
            <h1 class="">{{ subject_info.subject }} {{ subject_info.title }}</h1>
            {% if session['role'] == 'admin' %}
            <div>
                <a class="btn" href="{{ url_for('list_subjects') }}">Back to Subjects</a>
                <a class="btn profile-edit-btn" href="/editsubject?id={{ subject_info.id }}">Edit</a>
                <a class="btn profile-delete-btn" href="/deletesubject?id={{ subject_info.id }}" onclick="return confirm('Are you sure? you want to delete {{subject_info.title }} ({{ subject_info.subject }})')">Delete</a>
            </div>
            {% elif session['role'] == 'user' %}
            <div>
                <a class="btn" href="{{ url_for('user_add_subject', student_id=session['id'], subject_id=subject_info.id) }}">Select</a>
                <a class="btn profile-delete-btn" href="{{ url_for('delete_user_subject', id=subject_info.id) }}">Unselect</a>
                <a class="btn" href="{{ url_for('user_select_subject') }}">Return to list</a> 
            </div>
            {% else %}
            <div>
                <a class="btn" href="{{ url_for('home') }}">Please Login</a>
            </div>
            {% endif %}


        </div>
    </div>
    <h2>Description</h2>
    <p>{{ subject_info.description }}</p>
    <div class="profile-stats">
        <h2>Credit Information</h2>
        <ul>
            <li><span class="profile-stat-count">Internal Credits: {{ subject_info.internal_credits }}</span></li>
            <li><span class="profile-stat-count">External Credits: {{ subject_info.external_credits }}</span></li>
            <li><span class="profile-stat-count">Total Credits: {{ subject_info.total_credits}}</span></li>
        </ul>
    </div>
</header>

<h2>Other students that chose this subject</h2>
<table class="flat-table">
    <tr>
        <th></th>
        <th>Name</th>
        <th>Email</th>
        {% if session['role'] == 'admin' %}
        <th>Actions</th>
        {% endif %}
    </tr>
    {% for row in students_selected %}
    <tr>
        <td><img class="table-profile-img" src="{{ url_for('static', filename='images/' + (row.avatar or 'default.png')) }}" alt=""> </td>
        <td>{{row.first_name + " " + row.last_name }}</td>
        <td>{{ row.email }}</td>
        {% if session['role'] == 'admin' %}
        <td>
            <a href="/profile?id={{ row.student_id }}">View</a>
            <a href="/edit?id={{ row.student_id }}">Edit</a>
            <a href="/delete?id={{ row.student_id }}" onclick="return confirm('Are you sure? you want to delete {{row.first_name }} {{ row.last_name }}')">Delete</a>
            <a href="{{ url_for('view_user_subjects', id=row.student_id) }}">View subject choices</a>
        </td>
        {% endif %}
    </tr>
    {% endfor %}
</table>
{% endblock %}